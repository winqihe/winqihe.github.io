<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","width":240,"display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="HDFS MapReduce YARN">
<meta property="og:type" content="article">
<meta property="og:title" content="Hadoop">
<meta property="og:url" content="http://example.com/2022/03/03/Hadoop/index.html">
<meta property="og:site_name" content="WenQi&#96;s Blog">
<meta property="og:description" content="HDFS MapReduce YARN">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0082w7mmly8h01kfgx6g2j30ud0gp0u5.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/0082w7mmly8h011gaq5xej30te0lu76b.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h0128e6g95j30nr0amjss.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0082w7mmly8h011xz364sj30gz0b1dgm.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/0082w7mmly8h011x3wtgbj30ku0c5q3y.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/0082w7mmly8h0143iqerxj30qw0d8tby.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h0148rc90jj30ba02g3yg.jpg">
<meta property="og:image" content="https://tva4.sinaimg.cn/large/0082w7mmly8h013jtur26j30cf022aa0.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h013kyka07j31f70i0gnj.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0082w7mmly8h013s4e4vqj31f70i0gne.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h013wr7aaoj31f70i0di4.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h012120smaj30hq0bfmy7.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/0082w7mmly8h018835rytj30kc0cadgl.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h018evc6mwj30jw0f1aav.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/0082w7mmly8h018j4wxuyj30kc0b60u1.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0082w7mmly8h018kcz9j0j30k509q0tc.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/0082w7mmly8h018m68e0sj30k509q0tc.jpg">
<meta property="og:image" content="https://tva4.sinaimg.cn/large/0082w7mmly8h018q2xrp5j30p60djq4e.jpg">
<meta property="og:image" content="https://tva3.sinaimg.cn/large/0082w7mmly8h01gppj9o5j30pr0gb405.jpg">
<meta property="og:image" content="https://tva4.sinaimg.cn/large/0082w7mmly8h01hap4w61j31d60u0k2i.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0082w7mmly8h01h4jackzj30rs0rdn03.jpg">
<meta property="article:published_time" content="2022-03-03T05:43:39.000Z">
<meta property="article:modified_time" content="2022-03-10T08:36:46.942Z">
<meta property="article:author" content="Keven He">
<meta property="article:tag" content="Hadoop">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/0082w7mmly8h01kfgx6g2j30ud0gp0u5.jpg">


<link rel="canonical" href="http://example.com/2022/03/03/Hadoop/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/03/03/Hadoop/","path":"2022/03/03/Hadoop/","title":"Hadoop"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hadoop | WenQi`s Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WenQi`s Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">No thing is impossible!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首&emsp;&emsp;页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关&emsp;&emsp;于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标&emsp;&emsp;签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分&emsp;&emsp;类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归&emsp;&emsp;档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜&emsp;&emsp;索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#HDFS%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">HDFS概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HDFS%E8%AF%BB%E5%86%99%E6%B5%81%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">HDFS读写流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NN%E5%92%8C2NN%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">3.</span> <span class="nav-text">NN和2NN工作机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DataNode%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">4.</span> <span class="nav-text">DataNode工作机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HA%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">HA高可用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MapReduce%E6%A6%82%E8%BF%B0"><span class="nav-number">6.</span> <span class="nav-text">MapReduce概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MapReduce%E6%9E%B6%E6%9E%84"><span class="nav-number">7.</span> <span class="nav-text">MapReduce架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MapReduce%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">8.</span> <span class="nav-text">MapReduce执行过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map%E5%92%8CReduce"><span class="nav-number">9.</span> <span class="nav-text">Map和Reduce</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Shuffle%E6%9C%BA%E5%88%B6"><span class="nav-number">10.</span> <span class="nav-text">Shuffle机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#YARN%E6%A6%82%E8%BF%B0"><span class="nav-number">11.</span> <span class="nav-text">YARN概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#YARN%E6%9E%B6%E6%9E%84"><span class="nav-number">12.</span> <span class="nav-text">YARN架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#YARN%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">13.</span> <span class="nav-text">YARN工作机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%9C%E4%B8%9A%E6%8F%90%E4%BA%A4%E6%B5%81%E7%A8%8B"><span class="nav-number">14.</span> <span class="nav-text">作业提交流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#YARN%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="nav-number">15.</span> <span class="nav-text">YARN调度器</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Keven He"
      src="/images/avator.jpg">
  <p class="site-author-name" itemprop="name">Keven He</p>
  <div class="site-description" itemprop="description">No thing is impossible!</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/weixin_45462732" title="Blog → https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_45462732" rel="noopener" target="_blank"><i class="fa fa-coffee fa-fw"></i>Blog</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/03/Hadoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Keven He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WenQi`s Blog">
      <meta itemprop="description" content="No thing is impossible!">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hadoop | WenQi`s Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hadoop
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-03 13:43:39" itemprop="dateCreated datePublished" datetime="2022-03-03T13:43:39+08:00">2022-03-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-10 16:36:46" itemprop="dateModified" datetime="2022-03-10T16:36:46+08:00">2022-03-10</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span></span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>NaN:aN</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>HDFS MapReduce YARN</strong></p>
<span id="more"></span>

<p><img src="https://tva1.sinaimg.cn/large/0082w7mmly8h01kfgx6g2j30ud0gp0u5.jpg"></p>
<h4 id="HDFS概述"><a href="#HDFS概述" class="headerlink" title="HDFS概述"></a>HDFS概述</h4><p><strong>HDFS优缺点</strong></p>
<p>优点：高容错性，适合大规模数据处理，廉价成本</p>
<p>缺点：不适合低延时数据访问，无法高效对大量小文件存储，不支持并发写入，文件随即修改。</p>
<p><strong>HDFS组成架构</strong></p>
<p><img src="https://tva2.sinaimg.cn/large/0082w7mmly8h011gaq5xej30te0lu76b.jpg"></p>
<p>NameNode:管理HDFS名称空间，配置副本策略，管理数据块，处理客户端请求</p>
<p>DataNode:存储实际数据块，执行数据块的读写操作，</p>
<p>Client:文件切分，与NameNode交互获取文件位置信息，与DataNode交互，读写数据</p>
<p>SecondaryNameNode:辅助NameNode为其分担工作量(定期合并FSImage和Edit Log)，辅助恢复NameNode</p>
<p><strong>元数据格式</strong></p>
<p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h0128e6g95j30nr0amjss.jpg"></p>
<p><strong>Hadoop文件块大小</strong>默认为128M，文件块太小，会增加寻址时间；文件块太大，从磁盘传输数据的时间将大于定位数据块起始位置所需的时间，导致程序处理数据慢</p>
<p><strong>机架感知(副本节点选择)</strong></p>
<ol>
<li>第一个副本在client所处的节点上。如果客户端在集群外，随机选一个</li>
<li>第二个副本和第一个副本位于相同机架，随机节点。</li>
<li>第三个副本位于不同机架，随机节点</li>
</ol>
<p><strong>常用命令</strong></p>
<blockquote>
<p>-moveFromLocal,-copyFromLocal,-put,-appendToFile,-copyToLocal,-get,-ls,-cat,-cp,-mkdir,-mv,-tail,-rm,-rm -r,-du,-setrep</p>
</blockquote>
<h4 id="HDFS读写流程"><a href="#HDFS读写流程" class="headerlink" title="HDFS读写流程"></a>HDFS读写流程</h4><p><strong>HDFS写数据</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/0082w7mmly8h011xz364sj30gz0b1dgm.jpg"></p>
<ol>
<li>Client向NameNode请求上传文件</li>
<li>NameNode返回是否可以上传</li>
<li>Client请求第一个Block上传到那个DataNode</li>
<li>NameNode返回3个DataNode节点</li>
<li>Client请求datanode1上传数据，datanode1收到请求会继续调用datanode2，datanode2调用datanode3，将通信管道建立完</li>
<li>datanode1，2，3逐级应答Client</li>
<li>Client向datanode1上传第一个Block(Packet)，先从磁盘读数据放到本地进行缓存，datanode1收到一个Packet就会传给datanode2，datanode2传给datanode3，</li>
<li>当一个Block传输完，Client再次请求上传第二个Block</li>
</ol>
<p><strong>HDFS读数据</strong></p>
<p><img src="https://tva2.sinaimg.cn/large/0082w7mmly8h011x3wtgbj30ku0c5q3y.jpg"></p>
<ol>
<li>Client向NameNode请求下载文件，NameNode查询元数据，定位文件块所在DataNode地址</li>
<li>从(先就近后随机)DataNode请求读取数据</li>
<li>DataNode传输数据给Client(Packet)</li>
<li>Client(Packet)接受，先本地缓存后写入目标文件</li>
</ol>
<h4 id="NN和2NN工作机制"><a href="#NN和2NN工作机制" class="headerlink" title="NN和2NN工作机制"></a>NN和2NN工作机制</h4><p><img src="https://tva2.sinaimg.cn/large/0082w7mmly8h0143iqerxj30qw0d8tby.jpg"></p>
<p>NameNode启动：</p>
<ol>
<li>首次启动格式化，创建Fsimage，Edits，之后启动load edits和fsimage到内存</li>
<li>Client对元数据进行增删改请求</li>
<li>NameNode记录操作日志</li>
<li>NameNode在内存中对数据增删改</li>
</ol>
<p>SecondaryNode工作：</p>
<ol>
<li>2NN询问NN是否要CheckPoint</li>
<li>2NN请求执行CheckPoint</li>
<li>NN滚动正在写的Edits，将滚动前的edits和fsimage拷贝到2NN</li>
<li>2NN加载edits和fsimage到内存，并进行合并，生成新的fsimage.checkpoint</li>
<li>拷贝fsimage.checkpoint到NN，NN将fsimage.checkpoint更名为fsimage</li>
</ol>
<p><strong>FSImage和Edit Log</strong></p>
<p>fsimage保存了最新的元数据检查点，包含了整个HDFS文件系统的所有目录和文件的信息。</p>
<p>editlog在NameNode已经启动情况下对HDFS进行的各种更新操作进行记录，HDFS客户端执行所有的写操作都会被记录到editlog中</p>
<p>namenode在被格式化后会在/data/tmp/dfs/name/current目录下产生相应文件：</p>
<p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h0148rc90jj30ba02g3yg.jpg"></p>
<h4 id="DataNode工作机制"><a href="#DataNode工作机制" class="headerlink" title="DataNode工作机制"></a>DataNode工作机制</h4><p>​    一个数据块在DataNode上以文件形式存储在磁盘，分别是数据本身和元数据(数据块长度，数据块校验和，时间戳)</p>
<p><img src="https://tva4.sinaimg.cn/large/0082w7mmly8h013jtur26j30cf022aa0.jpg"></p>
<ol>
<li>DataNode启动后向NameNode注册，通过后周期性(1h)向NameNode上报所有块信息</li>
<li>心跳3s/次，心跳返回结果带有NameNode给DataNode的命令，若超过10min没有收到某个DataNode的心跳，则认为节点已挂</li>
<li>集群运行中可以服役新节点或退役旧节点</li>
</ol>
<p><strong>Client获取块数据</strong></p>
<p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h013kyka07j31f70i0gnj.jpg"></p>
<pre><code> 1. 客户端向namenode发送查询请求
 2. namenode返回数据块所在的节点datanode
 3. 客户端在返回的节点中寻找相应的块数据
 4. 如果某个datanode挂点了，返回相应的副本中寻找
</code></pre>
<p><strong>HDFS保证数据完整性</strong></p>
<p>客户端向HDFS写数据：</p>
<p><img src="https://tva1.sinaimg.cn/large/0082w7mmly8h013s4e4vqj31f70i0gne.jpg"></p>
<ol>
<li>假设客户端发送2KB的数据 </li>
<li>客户端会以字节的方式往datanode发送，所以客户端会计算发送的数据有多少个，而这个单位就是chunk（512字节）。</li>
<li>客户端可以计算出checksum值，checksum = 2KB/512B=4 </li>
<li>然后datanode接收客户端发送来的数据，每接收512B的数据，就让checksum的值+1 </li>
<li>最后比较客户端和datanade的checksum值</li>
</ol>
<p>DataNode读取Block块：</p>
<p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h013wr7aaoj31f70i0di4.jpg"></p>
<ol>
<li>block创建时会初始checksum值 </li>
<li>DataNode每隔一段时间就会计算block新的checksum值，看block块是否已经丢失 </li>
<li>如果checksum和之前一样，则没丢失，和之前比出现了不一样，那就说明数据丢失（或者异常） </li>
<li>当发生异常的时候，DateNode会报告给NameNode，NameNode会发送一条命令，清除这个异常块，然后找到这个块对应的副本，将完整的副本复制给其他的DataNode节点</li>
</ol>
<h4 id="HA高可用"><a href="#HA高可用" class="headerlink" title="HA高可用"></a>HA高可用</h4><p>HA即高可用(7*24不间断服务)</p>
<p>实现高可用最关键的策略是消除单点故障，通过配置Active/Standby两个NameNodes实现集群中对NameNode的热备</p>
<p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h012120smaj30hq0bfmy7.jpg"></p>
<p>Active NameNode 和 Standby NameNode：两台 NameNode 形成互备，一台处于 Active 状态，为主 NameNode，另外一台处于 Standby 状态，为备 NameNode,只有主 NameNode 才能对外提供读写服务</p>
<p>ZKFailoverController（主备切换控制器，FC）：ZKFailoverController 作为独立的进程运行，对 NameNode 的主备切换进行总体控制。ZKFailoverController 能及时检测到NameNode 的健康状况，在主 NameNode 故障时借助 Zookeeper 实现自动的主备选举和切换</p>
<p>Zookeeper 集群：为主备切换控制器提供主备选举支持；</p>
<p>共享存储系统：共享存储系统是实现 NameNode 的高可用最为关键的部分，共享存储系统保存了 NameNode 在运行过程中所产生的 HDFS 的元数据。主 NameNode 和备 NameNode 通过共享存储系统实现元数据同步。在进行主备切换的时候，新的主 NameNode 在确认元数据完全同步之后才能继续对外提供服务。</p>
<p>DataNode 节点：主 NameNode 和备 NameNode 需要共享 HDFS 的数据块和 DataNode 之间的映射关系，为了使故障切换能够快速进行，DataNode 会同时向主 NameNode 和备 NameNode 上报数据块的位置信息。</p>
<h4 id="MapReduce概述"><a href="#MapReduce概述" class="headerlink" title="MapReduce概述"></a>MapReduce概述</h4><p>官方文档的解释是：Hadoop Map/Reduce是一个使用简易的软件框架，基于它写出来的应用程序能够运行在由上千个商用机器组成的大型集群上，并以一种可靠容错的方式并行处理上T级别的数据集。</p>
<p>一个Map/Reduce <em>作业（job）</em> 通常会把输入的数据集切分为若干独立的数据块，由 <em>map任务（task）</em>以完全并行的方式处理它们。框架会对map的输出先进行排序， 然后把结果输入给<em>reduce任务</em>。通常作业的输入和输出都会被存储在文件系统中。 整个框架负责任务的调度和监控，以及重新执行已经失败的任务。</p>
<p>Map/Reduce框架由一个单独的master JobTracker 和每个集群节点一个slave TaskTracker共同组成。master负责调度构成一个作业的所有任务，这些任务分布在不同的slave上，master监控它们的执行，重新执行已经失败的任务。而slave仅负责执行由master指派的任务。</p>
<p><strong>MapReduce核心思想</strong></p>
<ol>
<li>分布式的计算通常要分为至少两个阶段</li>
<li>第一阶段的MapTask并发实例，完全并行运行</li>
<li>第二阶段的ReduceTask并发实例互不相干，但数据依赖于上个阶段所有MapTask并发实例的输出</li>
<li>MapReduce编程模型只能包含一个Map和Reduce阶段</li>
</ol>
<h4 id="MapReduce架构"><a href="#MapReduce架构" class="headerlink" title="MapReduce架构"></a>MapReduce架构</h4><p>MapReduce体系结构主要由四个部分组成，分别是：Client、JobTracker、TaskTracker以及Task</p>
<p>JobTracker是用于调度工作的，TaskTracker是用于执行工作的。<strong>一个Hadoop集群中只有一台JobTracker</strong><img src="https://tva2.sinaimg.cn/large/0082w7mmly8h018835rytj30kc0cadgl.jpg"></p>
<p>客户端向JobTracker提交一个作业，JobTracker把作业拆分为多份分配给TaskTracker执行，TaskTracker每隔一段时间会向JobTracker发送Heartbeat，如果一段时间内JobTracker没有收到来至TaskTracker的Heartbeat，将认为TaskTracker挂掉了，会把该TaskTracker的作业分配给其他TaskTracker</p>
<h4 id="MapReduce执行过程"><a href="#MapReduce执行过程" class="headerlink" title="MapReduce执行过程"></a>MapReduce执行过程</h4><p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h018evc6mwj30jw0f1aav.jpg"></p>
<p>1、客户端启动一个job<br>2、向JobTracker请求一个JobID<br>3、将运行作业所需要的资源文件复制到HDFS上，包括MapReduce程序打包的JAR文件、配置文件和客户端计算所得的输入划分信息。这些文件都存放在JobTracker专门为该作业创建的文件夹中，文件夹名为该作业JobID。JAR文件默认会有10个副本，输入划分信息告诉JobTracker应该为这个作业启动多少个map任务等信息。<br>4、JobTracker接收到作业后将其放在作业队列中，等待JobTracker对其进行调度。当JobTracker根据自己的调度算法调度该作业时，会根据输入划分信息为每个划分创建一个map任务，并将map任务分配给TaskTracker执行。这里需要注意的是，map任务不是随便分配给某个TaskTracker的，Data-Local（数据本地化）将map任务分配给含有该map处理的数据库的TaskTracker上，同时将程序JAR包复制到该TaskTracker上运行，但是分配reducer任务时不考虑数据本地化。<br>5、TaskTracker每隔一段时间给JobTracker发送一个Heartbeat告诉JobTracker它仍然在运行，同时心跳还携带很多比如map任务完成的进度等信息。当JobTracker收到作业的最后一个任务完成信息时，便把作业设置成“成功”，JobClient再传达信息给用户。</p>
<p><strong>输入输出</strong></p>
<p>Map/Reduce框架运转在&lt;key, value&gt; 键值对上， 框架把作业的输入看为是一组&lt;key, value&gt; 键值对，同样也产出一组 &lt;key, value&gt; 键值对做为作业的输出，这两组键值对的类型可能不同。</p>
<blockquote>
<p>(input) &lt;k1, v1&gt; -&gt; <strong>map</strong> -&gt; &lt;k2, v2&gt; -&gt; <strong>combine</strong> -&gt; &lt;k2, v2&gt; -&gt; <strong>reduce</strong> -&gt; &lt;k3, v3&gt; (output)</p>
</blockquote>
<p><strong>MapReduce优缺点</strong></p>
<p>优点：易于编程，良好扩展性，高容错性，适合PB级以上海量数据离线处理</p>
<p>缺点：不擅长实时计算，不擅长流式计算，不擅长DAG计算</p>
<h4 id="Map和Reduce"><a href="#Map和Reduce" class="headerlink" title="Map和Reduce"></a>Map和Reduce</h4><p><strong>(input) -&gt;map-&gt; -&gt;combine-&gt; -&gt;reduce-&gt; (output)</strong></p>
<p><img src="https://tva2.sinaimg.cn/large/0082w7mmly8h018j4wxuyj30kc0b60u1.jpg"></p>
<p><strong>map</strong>：map任务可细分四个阶段：record reader、mapper、combiner和partitioner。map任务的输出被称为中间键和中间值，会被发送到reducer做后续处理。</p>
<p><img src="https://tva1.sinaimg.cn/large/0082w7mmly8h018kcz9j0j30k509q0tc.jpg"></p>
<ol>
<li>读取HDFS中的文件。每一行解析成一个&lt;k,v&gt;。每一个键值对调用一次map函数。&lt;0,helloyou&gt; &lt;10,hello me&gt;</li>
<li>覆盖map()，接收（1）中产生的&lt;k,v&gt;，进行处理，转换为新的&lt;k,v&gt;输出。&lt;hello,1&gt;&lt;you,1&gt;&lt;hello,1&gt;&lt;me,1&gt;</li>
<li>对（2）输出的&lt;k,v&gt;进行<strong>分区</strong>，默认分为一个区。</li>
<li>对不同分区中的数据进行<strong>按照Key排序、分组</strong>。分组指的是相同key的value放到一个集合中。排序后：&lt;hello,1&gt;&lt;hello,1&gt;&lt;me,1&gt; &lt;you,1&gt;，分组后：&lt;hello,{1,1}&gt;&lt;me,{1}&gt;&lt;you,{1}&gt;</li>
<li>对分组后的数据进行<strong>合并归约</strong></li>
</ol>
<p><strong>reduce</strong>：reduce任务也分为四个阶段：混排（shuffle）、排序（sort）、reducer和输出格式（output format）</p>
<p><img src="https://tva2.sinaimg.cn/large/0082w7mmly8h018m68e0sj30k509q0tc.jpg"></p>
<ol>
<li>多个map任务的输出，按照不同的分区，通过网络copy到不同的reduce节点上。（shuffle）</li>
<li>对多个map的输出进行<strong>合并、排序</strong>。覆盖reduce函数，接收的是分组后的数据，实现自己的业务逻辑，&lt;hello,2&gt;&lt;me,1&gt;&lt;you,1&gt;处理后，产生新的&lt;k,v&gt;输出。</li>
<li>对reduce输出的&lt;k,v&gt;写到HDFS中。</li>
</ol>
<h4 id="Shuffle机制"><a href="#Shuffle机制" class="headerlink" title="Shuffle机制"></a><strong>Shuffle机制</strong></h4><p>mapper 阶段处理的数据如何传递给 reducer 阶段，是 MapReduce 框架中 最关键的一个流程，就叫 Shuffle</p>
<p>Shuffle: 数据混洗（核心机制：数据分区，排序，局部聚合，缓存，拉取，再合并 排序）,具体说就是就是将 MapTask 输出的处理结果数据，按照 Partitioner 组件制定的规则分发 给 ReduceTask，并在分发的过程中，对数据按 key 进行了分区和排序</p>
<p><img src="https://tva4.sinaimg.cn/large/0082w7mmly8h018q2xrp5j30p60djq4e.jpg"></p>
<ol>
<li>Collect阶段：MapTask的数据输出到环形缓冲区</li>
<li>Spill阶段：当内存中数据量到一定阈值，会将数据写入本地磁盘(将数据写入磁盘前需要对数据进行一次排序)，如果配置combiner会将相同分区号和key的数据进行排序</li>
<li>MapTask阶段的Merge：把所有溢出的临时文件进行一次merge，确保一个MapTask最终只产生一个中间数据文件</li>
<li>Copy阶段：ReduceTask启动Fetcher线程到已完成MapTask节点上copy一份数据</li>
<li>ReduceTask阶段的Merge：在ReduceTask复制数据同时，会在后台开启两个线程对内存到本地的数据文件进行merge</li>
<li>Sort阶段：对数据进行merge同时，会进行排序，由于MapTask阶段已经对数据进行了局部排序，ReduceTask只需保证Copy数据的最终整体有效性</li>
</ol>
<h4 id="YARN概述"><a href="#YARN概述" class="headerlink" title="YARN概述"></a>YARN概述</h4><p>是一个资源调度平台，负责为运算程序提供服务器运算资源</p>
<h4 id="YARN架构"><a href="#YARN架构" class="headerlink" title="YARN架构"></a>YARN架构</h4><p><img src="https://tva3.sinaimg.cn/large/0082w7mmly8h01gppj9o5j30pr0gb405.jpg"></p>
<p><strong>Container</strong>：Container是YARN对资源的抽象，封装了节点上多维度资源，像内存，cpu，磁盘，网络；容器由 NodeManager 启动和管理，并被它所监控；容器被 ResourceManager 进行调度。</p>
<p><strong>NodeManager</strong>：管理单个节点上的资源(负责启动和管理节点上的容器)；处理来自ResourceManager和ApplicationMaster的命令</p>
<p><strong>ResourceManager</strong>：处理客户端请求；监控NodeManager；启动和监控ApplicationMaster；资源的分配与调度；RM有定时调用器(Scheduler)和应用管理器(ApplicationManager)两个主要组件</p>
<p>定时调度器(Scheduler)：当 Client 提交一个任务的时候，它会根据所需要的资源以及当前集群的资源状况进行分配，只负责向应用程序分配资源，并不做监控以及应用程序的状态跟踪</p>
<p>应用管理器(ApplicationManager)：负责管理 Client 用户提交的应用</p>
<p><strong>ApplicationMaster</strong>：与 RM 调度器协商以获取资源（用 Container 表示）； 将得到的任务进一步分配给内部的任务；与 NM 通信以启动 / 停止任务；监控所有任务运行状态，并在任务运行失败时重新为任务申请资源以重启任务。</p>
<h4 id="YARN工作机制"><a href="#YARN工作机制" class="headerlink" title="YARN工作机制"></a>YARN工作机制</h4><p><img src="https://tva4.sinaimg.cn/large/0082w7mmly8h01hap4w61j31d60u0k2i.jpg"></p>
<h4 id="作业提交流程"><a href="#作业提交流程" class="headerlink" title="作业提交流程"></a>作业提交流程</h4><p><img src="https://tva1.sinaimg.cn/large/0082w7mmly8h01h4jackzj30rs0rdn03.jpg"></p>
<ol>
<li>Client向Yarn提交Application，这里我们假设是一个MapReduce作业。</li>
<li>ResourceManager向NodeManager通信，为该Application分配第一个容器。并在这个容器中运行这个应用程序对应的ApplicationMaster。</li>
<li>ApplicationMaster启动以后，对作业（也就是Application）进行拆分，拆分task出来，这些task可以运行在一个或多个容器中。然后向ResourceManager申请要运行程序的容器，并定时向ResourceManager发送心跳。</li>
<li>申请到容器后，ApplicationMaster会去和容器对应的NodeManager通信，而后将作业分发到对应的NodeManager中的容器去运行，这里会将拆分后的MapReduce进行分发，对应容器中运行的可能是Map任务，也可能是Reduce任务。</li>
<li>容器中运行的任务会向ApplicationMaster发送心跳，汇报自身情况。当程序运行完成后，ApplicationMaster再向ResourceManager注销并释放容器资源。</li>
</ol>
<h4 id="YARN调度器"><a href="#YARN调度器" class="headerlink" title="YARN调度器"></a>YARN调度器</h4><p>FIFO 、Capacity Scheduler（容量调度器）和Fair Sceduler（公平调度器）</p>
<p>FIFO调度器：支持单队列 、先进先出  生产环境不会用。</p>
<p>容量调度器：支持多队列，保证先进入的任务优先执行。</p>
<p>公平调度器：支持多队列，保证每个任务公平享有队列资源。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Hadoop/" rel="tag"><i class="fa fa-tag"></i># Hadoop</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/2022/03/04/Spark/" rel="next" title="Spark">
                  Spark <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fab fa-microblog"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Keven He</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">NaNm</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">NaN:aN</span>
  </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

<!--以下为添加的代码-->
      <!--统计start-->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <div class="powered-by">
        <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
          本站访客数:<span id="busuanzi_value_site_uv"></span>
        </span>
        </div>


    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>

</html>
